<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.xj_service.oa.mapper.UserMapper">

    <select id="getUsersByRoleCode"  parameterType="list" resultType="org.xj_service.oa.entity.User">
        SELECT DISTINCT u.*
        FROM sys_user u
        INNER JOIN sys_user_role ur ON u.id = ur.user_id
        INNER JOIN sys_role r ON ur.role_id = r.id
        WHERE r.code IN
        <foreach collection="codeNames" item="code" open="(" separator="," close=")">
            #{code}
        </foreach>
    </select>

    <select id="getDepartmentUser" resultType="org.xj_service.oa.entity.User">
        SELECT u.*
        FROM sys_department d
        JOIN sys_user u ON d.leader_id = u.id
        WHERE d.id = (
        SELECT department_id
        FROM sys_user
        WHERE id =  #{userId}
        )
    </select>

    <select id="getUserWithDepartment" resultType="org.xj_service.oa.entity.User">
        SELECT u.*, d.id as department_id, d.name as department_name
        FROM sys_user u
        LEFT JOIN sys_department d ON u.department_id = d.id
        WHERE u.id = #{userId}
    </select>

    <!-- 新增：查询所有角色为ROLE_VICE_LEADER（分管领导）的用户 -->
    <select id="getViceLeaderUsers" resultType="org.xj_service.oa.entity.User">
        SELECT DISTINCT u.*
        FROM sys_user u
        INNER JOIN sys_user_role ur ON u.id = ur.user_id
        INNER JOIN sys_role r ON ur.role_id = r.id
        WHERE r.code = 'ROLE_VICE_LEADER'
        <!-- 可选：添加启用状态过滤（如果有is_enabled字段） -->
        <!-- AND u.is_enabled = 1 -->
        ORDER BY u.id ASC
    </select>


</mapper>
